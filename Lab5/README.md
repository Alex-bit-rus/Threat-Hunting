# –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –±–µ—Å–ø—Ä–æ–≤–æ–¥–Ω—ã—Ö —Å–µ—Ç–µ–π
alexkondrol@yandex.ru

## –¶–µ–ª—å —Ä–∞–±–æ—Ç—ã

1.  –ü–æ–ª—É—á–∏—Ç—å –∑–Ω–∞–Ω–∏—è –æ –º–µ—Ç–æ–¥–∞—Ö –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è —Ä–∞–¥–∏–æ—ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –æ–±—Å—Ç–∞–Ω–æ–≤–∫–∏.
2.  –°–æ—Å—Ç–∞–≤–∏—Ç—å –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –æ –º–µ—Ö–∞–Ω–∏–∑–º–∞—Ö —Ä–∞–±–æ—Ç—ã Wi-Fi —Å–µ—Ç–µ–π –Ω–∞ –∫–∞–Ω–∞–ª—å–Ω–æ–º
    –∏ —Å–µ—Ç–µ–≤–æ–º —É—Ä–æ–≤–Ω–µ –º–æ–¥–µ–ª–∏ OSI.
3.  –ó–µ–∫—Ä–µ–ø–∏—Ç—å –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –Ω–∞–≤—ã–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —è–∑—ã–∫–∞ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è R
    –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö
4.  –ó–∞–∫—Ä–µ–ø–∏—Ç—å –∑–Ω–∞–Ω–∏—è –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö —ç–∫–æ—Å–∏—Å—Ç–µ–º—ã
    tidyverse —è–∑—ã–∫–∞ R

## –ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

1.  –û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ GNU/Linux
2.  –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä —è–∑—ã–∫–∞ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è R
3.  –†–µ–¥–∞–∫—Ç–æ—Ä –∫–æ–¥–∞ `Positron`
4.  –ñ—É—Ä–Ω–∞–ª—ã –ø—Ä–æ–≥—Ä–∞–º–º–Ω—ã—Ö —Å—Ä–µ–¥—Å—Ç–≤ –∞–Ω–∞–ª–∏–∑–∞ –±–µ—Å–ø—Ä–æ–≤–æ–¥–Ω—ã—Ö —Å–µ—Ç–µ–π ‚Äì `tcpdump` –∏
    `airodump-ng`

## –ó–∞–¥–∞–Ω–∏–µ

–ò—Å–ø–æ–ª—å–∑—É—è –ø—Ä–æ–≥—Ä–∞–º–º–Ω—ã–π –ø–∞–∫–µ—Ç `dplyr` —è–∑—ã–∫–∞ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è R –ø—Ä–æ–≤–µ—Å—Ç–∏
–∞–Ω–∞–ª–∏–∑ –∂—É—Ä–Ω–∞–ª–æ–≤ –∏ –æ—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã

## –•–æ–¥ —Ä–∞–±–æ—Ç—ã

1.  –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö 1.1. –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ
    (https://storage.yandexcloud.net/dataset.ctfsec/P2_wi_data.csv) 1.2.
    –ü—Ä–∏–≤–µ—Å—Ç–∏ –¥–∞—Ç–∞—Å–µ—Ç—ã –≤ –≤–∏–¥ ‚Äú–∞–∫–∫—É—Ä–∞—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö‚Äù, –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å —Ç–∏–ø—ã
    —Å—Ç–æ–ª–±—Ü–æ–≤ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å —Ç–∏–ø–æ–º –¥–∞–Ω–Ω—ã—Ö 1.3. –ü—Ä–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –æ–±—â—É—é
    —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö —Å –ø–æ–º–æ—â—å—é —Ñ—É–Ω–∫—Ü–∏–∏ `glimpse()`
2.  –ê–Ω–∞–ª–∏–∑ 2.1 –ê–Ω–∞–ª–∏–∑ —Ç–æ—á–µ–∫ –¥–æ—Å—Ç—É–ø–∞ 2.1.1 –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ —Ç–æ—á–∫–∏
    –¥–æ—Å—Ç—É–ø–∞ (–±–µ–∑ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è ‚Äì OPN) 2.1.2. –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—è –¥–ª—è
    –∫–∞–∂–¥–æ–≥–æ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–Ω–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ 2.1.3. –í—ã—è–≤–∏—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞,
    –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–µ –ø–æ—Å–ª–µ–¥–Ω—é—é –≤–µ—Ä—Å–∏—é –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è WPA3, –∏ –Ω–∞–∑–≤–∞–Ω–∏—è
    —Ç–æ—á–µ–∫ –¥–æ—Å—Ç—É–ø–∞, —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –Ω–∞ —ç—Ç–∏—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö 2.1.4.
    –û—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ—á–∫–∏ –¥–æ—Å—Ç—É–ø–∞ –ø–æ –∏–Ω—Ç–µ—Ä–≤–∞–ª—É –≤—Ä–µ–º–µ–Ω–∏, –≤ —Ç–µ—á–µ–Ω–∏–µ –∫–æ—Ç–æ—Ä–æ–≥–æ
    –æ–Ω–∏ –Ω–∞—Ö–æ–¥–∏–ª–∏—Å—å –Ω–∞ —Å–≤—è–∑–∏, –ø–æ —É–±—ã–≤–∞–Ω–∏—é. 2.1.5. –û–±–Ω–∞—Ä—É–∂–∏—Ç—å —Ç–æ–ø-10 —Å–∞–º—ã—Ö
    –±—ã—Å—Ç—Ä—ã—Ö —Ç–æ—á–µ–∫ –¥–æ—Å—Ç—É–ø–∞. 2.1.6. –û—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ—á–∫–∏ –¥–æ—Å—Ç—É–ø–∞ –ø–æ —á–∞—Å—Ç–æ—Ç–µ
    –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ (beacons) –≤ –µ–¥–∏–Ω–∏—Ü—É –≤—Ä–µ–º–µ–Ω–∏ –ø–æ –∏—Ö —É–±—ã–≤–∞–Ω–∏—é. 2.2
    –ê–Ω–∞–ª–∏–∑ –∫–ª–∏–µ–Ω—Ç–æ–≤ 2.2.1 –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ
    –æ–±–Ω–∞—Ä—É–∂–µ–Ω–Ω–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞. 2.2.2 –û–±–Ω–∞—Ä—É–∂–∏—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞, –∫–æ—Ç–æ—Ä—ã–µ –ù–ï
    —Ä–∞–Ω–¥–æ–º–∏–∑–∏—Ä—É—é—Ç —Å–≤–æ–π MAC –∞–¥—Ä–µ—Å 2.2.3. –ö–ª–∞—Å—Ç–µ—Ä–∏–∑–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã –æ—Ç
    —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –∫ —Ç–æ—á–∫–∞–º –¥–æ—Å—Ç—É–ø–∞ –ø–æ –∏—Ö –∏–º–µ–Ω–∞–º. –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –≤—Ä–µ–º—è –ø–æ—è–≤–ª–µ–Ω–∏—è
    —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –≤ –∑–æ–Ω–µ —Ä–∞–¥–∏–æ–≤–∏–¥–∏–º–æ—Å—Ç–∏ –∏ –≤—Ä–µ–º—è –≤—ã—Ö–æ–¥–∞ –µ–≥–æ –∏–∑ –Ω–µ–µ. 2.2.4.
    –û—Ü–µ–Ω–∏—Ç—å —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å —É—Ä–æ–≤–Ω—è —Å–∏–≥–Ω–∞–ª–∞ –≤–Ω—É—Ä–∏ –∫–ª–∞—Å—Ç–µ—Ä–∞ –≤–æ –≤—Ä–µ–º–µ–Ω–∏.
    –í—ã—è–≤–∏—Ç—å –Ω–∞–∏–±–æ–ª–µ–µ —Å—Ç–∞–±–∏–ª—å–Ω—ã–π –∫–ª–∞—Å—Ç–µ—Ä.
3.  –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –æ—Ç—á–µ—Ç–∞

### –®–∞–≥ 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö

–î–ª—è –Ω–∞—á–∞–ª–∞ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–∞–∫–µ—Ç—ã:

``` r
library(dplyr)
```


    Attaching package: 'dplyr'

    The following objects are masked from 'package:stats':

        filter, lag

    The following objects are masked from 'package:base':

        intersect, setdiff, setequal, union

``` r
library(stringr)
library(tidyr)
library(knitr)
library(readr)
```

–°–∫–∞—á–∞–µ–º —Ñ–∞–π–ª:

``` r
temp_dir <- tempdir()
download.file(
  url = "https://storage.yandexcloud.net/dataset.ctfsec/P2_wifi_data.csv",
  destfile = file.path(temp_dir, "P2_wifi_data.csv"),
  mode = "wb"
)
```

–°—á–∏—Ç–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ñ–∞–π–ª–∞:

``` r
wifi_ap <- read_csv(file.path(temp_dir, "P2_wifi_data.csv"),
                      n_max = 167)
```

    Rows: 167 Columns: 15
    ‚îÄ‚îÄ Column specification ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    Delimiter: ","
    chr  (6): BSSID, Privacy, Cipher, Authentication, LAN IP, ESSID
    dbl  (6): channel, Speed, Power, # beacons, # IV, ID-length
    lgl  (1): Key
    dttm (2): First time seen, Last time seen

    ‚Ñπ Use `spec()` to retrieve the full column specification for this data.
    ‚Ñπ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
clients <- read_csv(file.path(temp_dir, "P2_wifi_data.csv"),
                      skip = 169)
```

    Warning: One or more parsing issues, call `problems()` on your data frame for details,
    e.g.:
      dat <- vroom(...)
      problems(dat)

    Rows: 12081 Columns: 7
    ‚îÄ‚îÄ Column specification ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    Delimiter: ","
    chr  (3): Station MAC, BSSID, Probed ESSIDs
    dbl  (2): Power, # packets
    dttm (2): First time seen, Last time seen

    ‚Ñπ Use `spec()` to retrieve the full column specification for this data.
    ‚Ñπ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
head(clients, 2)
```

    # A tibble: 2 √ó 7
      `Station MAC`  `First time seen`   `Last time seen`    Power `# packets` BSSID
      <chr>          <dttm>              <dttm>              <dbl>       <dbl> <chr>
    1 CA:66:3B:8F:5‚Ä¶ 2023-07-28 09:13:03 2023-07-28 10:59:44   -33         858 BE:F‚Ä¶
    2 96:35:2D:3D:8‚Ä¶ 2023-07-28 09:13:03 2023-07-28 09:13:03   -65           4 (not‚Ä¶
    # ‚Ñπ 1 more variable: `Probed ESSIDs` <chr>

–ü–µ—Ä–µ–∏–º–µ–Ω—É–µ–º –Ω–∞–∑–≤–∞–Ω–∏—è –∞—Ç—Ç—Ä–∏–±—É—Ç–æ–≤ –∏ –ø—Ä–∏–≤–µ–¥–µ–º –∞—Ç—Ç—Ä–∏–±—É—Ç—ã –∫ –Ω—É–∂–Ω–æ–º—É —Ç–∏–ø—É
–¥–∞–Ω–Ω—ã—Ö –¥–ª—è –¥–∞—Ç–∞—Å–µ—Ç–∞ —Ç–æ—á–µ–∫ –¥–æ—Å—Ç—É–ø–∞:

``` r
names(wifi_ap) <- trimws(names(wifi_ap))

wifi_ap_clean <-  wifi_ap %>%
  rename(
    bssid       = BSSID,
    first_seen  = `First time seen`,
    last_seen   = `Last time seen`,
    channel     = channel,
    speed       = Speed,
    privacy     = Privacy,
    cipher      = Cipher,
    auth        = Authentication,
    power       = Power,
    beacons     = `# beacons`,
    iv_count    = `# IV`,
    lan_ip      = `LAN IP`,
    id_length   = `ID-length`,
    essid       = ESSID,
    key         = Key
  ) %>%

mutate(across(where(is.character), ~trimws(.))) %>%
  mutate(
    first_seen = as.POSIXct(first_seen, format = "%Y-%m-%d %H:%M:%S", tz = "UTC"),
    last_seen  = as.POSIXct(last_seen,  format = "%Y-%m-%d %H:%M:%S", tz = "UTC"),
    channel    = as.numeric(channel),
    speed      = as.numeric(speed),
    power      = as.numeric(power),
    beacons    = as.numeric(beacons),
    iv_count   = as.numeric(iv_count),
    id_length  = as.numeric(id_length)
  ) %>%
  tibble::as_tibble()
```

–ü—Ä–æ–¥–µ–ª–∞–µ–º –∞–Ω–∞–ª–∞–≥–∏—á–Ω—É—é –æ–ø–µ—Ä–∞—Ü–∏—é —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏:

``` r
names(clients) <- trimws(names(clients))

wifi_clients_clean <- clients %>%
  rename(
    station_mac   = `Station MAC`,
    first_seen    = `First time seen`,
    last_seen     = `Last time seen`,
    power         = Power,
    packets       = `# packets`,
    bssid         = BSSID,
    probed_essids = `Probed ESSIDs`
  ) %>%
  mutate(across(where(is.character), ~ trimws(.))) %>%
  mutate(
    first_seen = as.POSIXct(first_seen, format = "%Y-%m-%d %H:%M:%S", tz = "UTC"),
    last_seen  = as.POSIXct(last_seen,  format = "%Y-%m-%d %H:%M:%S", tz = "UTC"),
    power      = as.numeric(power),
    packets    = as.numeric(packets),
    station_mac = toupper(station_mac),
    bssid = case_when(
      is.na(bssid) ~ NA_character_,
      grepl("(?i)<?not associated>?", bssid) ~ NA_character_,
      TRUE ~ toupper(bssid)
    )
  ) %>%
  tibble::as_tibble()
```

–¢–µ–ø–µ—Ä—å –ø–æ—Å–º–æ—Ç—Ä–∏–º –æ–±—â—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ñ–∞–π–ª–æ–≤:

``` r
glimpse(wifi_ap_clean)
```

    Rows: 167
    Columns: 15
    $ bssid      <chr> "BE:F1:71:D5:17:8B", "6E:C7:EC:16:DA:1A", "9A:75:A8:B9:04:1‚Ä¶
    $ first_seen <dttm> 2023-07-28 09:13:03, 2023-07-28 09:13:03, 2023-07-28 09:13‚Ä¶
    $ last_seen  <dttm> 2023-07-28 11:50:50, 2023-07-28 11:55:12, 2023-07-28 11:53‚Ä¶
    $ channel    <dbl> 1, 1, 1, 7, 6, 6, 11, 11, 11, 1, 6, 14, 11, 11, 6, 6, 6, 6,‚Ä¶
    $ speed      <dbl> 195, 130, 360, 360, 130, 130, 195, 130, 130, 195, 180, 65, ‚Ä¶
    $ privacy    <chr> "WPA2", "WPA2", "WPA2", "WPA2", "WPA2", "OPN", "WPA2", "WPA‚Ä¶
    $ cipher     <chr> "CCMP", "CCMP", "CCMP", "CCMP", "CCMP", NA, "CCMP", "CCMP",‚Ä¶
    $ auth       <chr> "PSK", "PSK", "PSK", "PSK", "PSK", NA, "PSK", "PSK", "PSK",‚Ä¶
    $ power      <dbl> -30, -30, -68, -37, -57, -63, -27, -38, -38, -66, -42, -62,‚Ä¶
    $ beacons    <dbl> 846, 750, 694, 510, 647, 251, 1647, 1251, 704, 617, 1390, 1‚Ä¶
    $ iv_count   <dbl> 504, 116, 26, 21, 6, 3430, 80, 11, 0, 0, 86, 0, 0, 0, 907, ‚Ä¶
    $ lan_ip     <chr> "0.  0.  0.  0", "0.  0.  0.  0", "0.  0.  0.  0", "0.  0. ‚Ä¶
    $ id_length  <dbl> 12, 4, 2, 14, 25, 13, 12, 13, 24, 12, 10, 0, 24, 24, 12, 0,‚Ä¶
    $ essid      <chr> "C322U13 3965", "Cnet", "KC", "POCO X5 Pro 5G", NA, "MIREA_‚Ä¶
    $ key        <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,‚Ä¶

``` r
glimpse(wifi_clients_clean)
```

    Rows: 12,081
    Columns: 7
    $ station_mac   <chr> "CA:66:3B:8F:56:DD", "96:35:2D:3D:85:E6", "5C:3A:45:9E:1‚Ä¶
    $ first_seen    <dttm> 2023-07-28 09:13:03, 2023-07-28 09:13:03, 2023-07-28 09‚Ä¶
    $ last_seen     <dttm> 2023-07-28 10:59:44, 2023-07-28 09:13:03, 2023-07-28 11‚Ä¶
    $ power         <dbl> -33, -65, -39, -61, -53, -43, -31, -71, -74, -65, -45, -‚Ä¶
    $ packets       <dbl> 858, 4, 432, 958, 1, 344, 163, 3, 115, 437, 265, 77, 7, ‚Ä¶
    $ bssid         <chr> "BE:F1:71:D5:17:8B", NA, "BE:F1:71:D6:10:D7", "BE:F1:71:‚Ä¶
    $ probed_essids <chr> "C322U13 3965", "IT2 Wireless", "C322U21 0566", "C322U13‚Ä¶

### –®–∞–≥ 2. –ê–Ω–∞–ª–∏–∑

#### 1. –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ —Ç–æ—á–∫–∏ –¥–æ—Å—Ç—É–ø–∞ (–±–µ–∑ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è ‚Äì OPN)

``` r
wifi_ap_clean %>% filter(privacy == "OPN")
```

    # A tibble: 42 √ó 15
       bssid    first_seen          last_seen           channel speed privacy cipher
       <chr>    <dttm>              <dttm>                <dbl> <dbl> <chr>   <chr> 
     1 E8:28:C‚Ä¶ 2023-07-28 09:13:03 2023-07-28 11:55:38       6   130 OPN     <NA>  
     2 E8:28:C‚Ä¶ 2023-07-28 09:13:06 2023-07-28 11:55:12       6   130 OPN     <NA>  
     3 E8:28:C‚Ä¶ 2023-07-28 09:13:06 2023-07-28 11:55:11       6   130 OPN     <NA>  
     4 E8:28:C‚Ä¶ 2023-07-28 09:13:06 2023-07-28 11:55:10       6    -1 OPN     <NA>  
     5 00:25:0‚Ä¶ 2023-07-28 09:13:06 2023-07-28 11:56:21      44    -1 OPN     <NA>  
     6 E8:28:C‚Ä¶ 2023-07-28 09:13:09 2023-07-28 11:56:05      11   130 OPN     <NA>  
     7 E8:28:C‚Ä¶ 2023-07-28 09:13:13 2023-07-28 10:27:06       6   130 OPN     <NA>  
     8 E8:28:C‚Ä¶ 2023-07-28 09:13:13 2023-07-28 10:39:43       6   130 OPN     <NA>  
     9 E8:28:C‚Ä¶ 2023-07-28 09:13:17 2023-07-28 11:52:32       1   130 OPN     <NA>  
    10 E8:28:C‚Ä¶ 2023-07-28 09:13:50 2023-07-28 11:43:39      11   130 OPN     <NA>  
    # ‚Ñπ 32 more rows
    # ‚Ñπ 8 more variables: auth <chr>, power <dbl>, beacons <dbl>, iv_count <dbl>,
    #   lan_ip <chr>, id_length <dbl>, essid <chr>, key <lgl>

### 2. –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–Ω–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞

–ë—É–¥–µ–º –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏–ª—è –ø–æ MAC-–∞–¥—Ä–µ—Å—É —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞, –¥–ª—è —ç—Ç–æ–≥–æ
–æ–±—Ä–∞—Ç–∏–º—Å—è –∫ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–º –¥–∞–Ω–Ω—ã–º IEEE

``` r
urls <- c(
  "https://standards-oui.ieee.org/oui/oui.csv",
  "https://standards-oui.ieee.org/oui28/mam.csv",
  "https://standards-oui.ieee.org/oui36/oui36.csv"
)
files <- file.path(temp_dir, basename(urls))

for (i in seq_along(urls)) {
  download.file(urls[i], files[i], mode = "wb", quiet = TRUE)
}

oui_data <- readr::read_csv(files[1], show_col_types = FALSE)
mam_data <- readr::read_csv(files[2], show_col_types = FALSE)
mas_data <- readr::read_csv(files[3], show_col_types = FALSE)
```

–ù–∞–ø–∏—à–µ–º —Ñ—É–Ω–∫—Ü–∏—é, –∫–æ—Ç–æ—Ä–∞—è –ø–æ MAC-–∞–¥—Ä–µ—Å—É –±—É–¥–µ—Ç –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—è
—É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞, –æ–ø–∏—Ä–∞—è—Å—å –Ω–∞ —Å–∫–∞—á–∞–Ω–Ω—ã–µ csv-—Ç–∞–±–ª–∏—Ü—ã, –≤ –∫–∞–∂–¥–æ–π —Ç–∞–±–ª–∏—Ü—ã —Ä–∞–∑–Ω–∞—è
–¥–ª–∏–Ω–∞ –ø—Ä–µ—Ñ–∏–∫—Å–∞ MAC-–∞–¥—Ä–µ—Å–∞, –∫–æ—Ç–æ—Ä—É—é –∫–æ–º–ø–∞–Ω–∏—è –∞—Ä–µ–Ω–¥—É–µ—Ç —É IEEE.

``` r
normalize_mac <- function(x) toupper(gsub("[^0-9A-F]", "", x))

.vendor_cache <- new.env(parent = emptyenv())

get_vendor <- function(mac) {
  mac_clean <- normalize_mac(mac)
  if (mac_clean == "" || is.na(mac_clean)) return(NA_character_)

  if (!is.null(.vendor_cache[[mac_clean]])) {
    return(.vendor_cache[[mac_clean]])
  }

  prefixes <- c(
    substr(mac_clean, 1, 9),  # /36
    substr(mac_clean, 1, 7),  # /28
    substr(mac_clean, 1, 6)   # /24
  )

  vendor <- NA_character_

  pref36 <- prefixes[1]
  if (!is.na(pref36) && nchar(pref36) == 9 && "Assignment" %in% names(mas_data)) {
    idx <- grepl(pref36, mas_data$Assignment, fixed = TRUE)
    if (any(idx)) {
      vendor <- mas_data$`Organization Name`[which(idx)[1]]
    }
  }

  if (is.na(vendor) || vendor == "") {
    pref28 <- prefixes[2]
    if (!is.na(pref28) && nchar(pref28) == 7 && "Assignment" %in% names(mam_data)) {
      idx <- grepl(pref28, mam_data$Assignment, fixed = TRUE)
      if (any(idx)) {
        vendor <- mam_data$`Organization Name`[which(idx)[1]]
      }
    }
  }

  if (is.na(vendor) || vendor == "") {
    pref24 <- prefixes[3]
    if (!is.na(pref24) && nchar(pref24) == 6 && "Assignment" %in% names(oui_data)) {
      idx <- grepl(pref24, oui_data$Assignment, fixed = TRUE)
      if (any(idx)) {
        vendor <- oui_data$`Organization Name`[which(idx)[1]]
      }
    }
  }

  if (is.na(vendor) || vendor == "") {
    vendor <- NA_character_
  }

  .vendor_cache[[mac_clean]] <- vendor
  vendor
}
```

–¢–µ–ø–µ—Ä—å –¥–æ–±–∞–≤–∏–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Å—Ç–æ–ª–±–µ—Ü `company` –≤ –Ω–∞—à –¥–∞—Ç–∞—Å–µ—Ç —Ç–æ—á–µ–∫
–¥–æ—Å—Ç—É–ø–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ `get_vendor()`

``` r
wifi_ap_clean <- wifi_ap_clean %>%
  mutate(company = vapply(bssid, get_vendor, character(1)))
```

#### 3. –í—ã—è–≤–∏—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–µ –ø–æ—Å–ª–µ–¥–Ω—é—é –≤–µ—Ä—Å–∏—é –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è WPA3, –∏ –Ω–∞–∑–≤–∞–Ω–∏—è —Ç–æ—á–µ–∫ –¥–æ—Å—Ç—É–ø–∞, —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –Ω–∞ —ç—Ç–∏—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö?

–ù–∞–º –Ω—É–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫–∏, –≥–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è WPA3 –∏–ª–∏ SAE (–ø—Ä–∏–∑–Ω–∞–∫
WPA3-Personal),

``` r
wpa3_aps <- wifi_ap_clean %>%
  filter(grepl("WPA3", privacy, ignore.case = TRUE) | grepl("SAE", auth, ignore.case = TRUE)) %>%
  select(bssid, essid, auth)

wpa3_aps
```

    # A tibble: 8 √ó 3
      bssid             essid                auth   
      <chr>             <chr>                <chr>  
    1 26:20:53:0C:98:E8 <NA>                 SAE PSK
    2 A2:FE:FF:B8:9B:C9 Christie‚Äôs           SAE PSK
    3 96:FF:FC:91:EF:64 <NA>                 SAE PSK
    4 CE:48:E7:86:4E:33 iPhone (–ê–Ω–∞—Å—Ç–∞—Å–∏—è)   SAE PSK
    5 8E:1F:94:96:DA:FD iPhone (–ê–Ω–∞—Å—Ç–∞—Å–∏—è)   SAE PSK
    6 BE:FD:EF:18:92:44 –î–∏–º–∞—Å–∏–∫              SAE PSK
    7 3A:DA:00:F9:0C:02 iPhone XS Max ü¶äüê±ü¶ä SAE PSK
    8 76:C5:A0:70:08:96 <NA>                 SAE PSK

#### 4. –û—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ—á–∫–∏ –¥–æ—Å—Ç—É–ø–∞ –ø–æ –∏–Ω—Ç–µ—Ä–≤–∞–ª—É –≤—Ä–µ–º–µ–Ω–∏, –≤ —Ç–µ—á–µ–Ω–∏–µ –∫–æ—Ç–æ—Ä–æ–≥–æ –æ–Ω–∏ –Ω–∞—Ö–æ–¥–∏–ª–∏—Å—å –Ω–∞ —Å–≤—è–∑–∏, –ø–æ —É–±—ã–≤–∞–Ω–∏—é

–°–∫–ª–µ–∏–º —Å–µ—Å—Å–∏–∏ –∏ –æ—Ç—Å–æ—Ä—Ç–∏—Ä—É–µ–º –∏—Ö –ø–æ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏. –°–µ—Å—Å–∏–∏ —Å—á–∏—Ç–∞—é—Ç—Å—è
–Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–º–∏, –µ—Å–ª–∏ –∏–Ω—Ç–µ—Ä–≤–∞–ª –º–µ–∂–¥—É –æ–∫–æ–Ω—á–∞–Ω–∏–µ–º –ø—Ä–µ–¥—ã–¥—É—â–µ–π –∏ –Ω–∞—á–∞–ª–æ–º
—Å–ª–µ–¥—É—é—â–µ–π –∑–∞–ø–∏—Å–∏ –ø–æ –æ–¥–Ω–æ–π —Ç–æ—á–∫–µ –¥–æ—Å—Ç—É–ø–∞ –ø—Ä–µ–≤—ã—à–∞–µ—Ç 45 –º–∏–Ω—É—Ç.

``` r
wifi_ap_sessions <- wifi_ap_clean %>%
arrange(bssid, first_seen) %>%
group_by(bssid) %>%
mutate(
gap_min = as.numeric(difftime(first_seen, lag(last_seen), units = "mins")),
new_session = if_else(is.na(gap_min) | gap_min > 45, 1L, 0L),
session_id  = cumsum(replace_na(new_session, 0L))
) %>%
group_by(bssid, session_id) %>%
summarise(
essid       = first(essid),
company     = first(company),
first_seen  = min(first_seen, na.rm = TRUE),
last_seen   = max(last_seen,  na.rm = TRUE),
beacons     = sum(beacons, na.rm = TRUE),
speed       = max(speed, na.rm = TRUE),
mean_power  = mean(power, na.rm = TRUE),
.groups = "drop"
) %>%
mutate(
duration    = as.numeric(difftime(last_seen, first_seen, units = "secs")),
beacon_rate = beacons / duration
)
```

``` r
wifi_ap_sorted_duration <- wifi_ap_sessions %>%
arrange(desc(duration)) %>%
select(bssid, essid, company, session_id, duration, first_seen, last_seen)

wifi_ap_sorted_duration
```

    # A tibble: 167 √ó 7
       bssid             essid       company session_id duration first_seen         
       <chr>             <chr>       <chr>        <int>    <dbl> <dttm>             
     1 00:25:00:FF:94:73 <NA>        Apple,‚Ä¶          1     9795 2023-07-28 09:13:06
     2 E8:28:C1:DD:04:52 MIREA_HOTS‚Ä¶ Eltex ‚Ä¶          1     9776 2023-07-28 09:13:09
     3 E8:28:C1:DC:B2:52 MIREA_HOTS‚Ä¶ Eltex ‚Ä¶          1     9755 2023-07-28 09:13:03
     4 08:3A:2F:56:35:FE <NA>        Guangz‚Ä¶          1     9746 2023-07-28 09:13:27
     5 6E:C7:EC:16:DA:1A Cnet        <NA>             1     9729 2023-07-28 09:13:03
     6 E8:28:C1:DC:B2:50 MIREA_GUES‚Ä¶ Eltex ‚Ä¶          1     9726 2023-07-28 09:13:06
     7 48:5B:39:F9:7A:48 <NA>        ASUSTe‚Ä¶          1     9725 2023-07-28 09:13:06
     8 E8:28:C1:DC:B2:51 <NA>        Eltex ‚Ä¶          1     9725 2023-07-28 09:13:06
     9 E8:28:C1:DC:FF:F2 <NA>        Eltex ‚Ä¶          1     9724 2023-07-28 09:13:06
    10 8E:55:4A:85:5B:01 Vladimir    <NA>             1     9723 2023-07-28 09:13:06
    # ‚Ñπ 157 more rows
    # ‚Ñπ 1 more variable: last_seen <dttm>

#### 5. –û–±–Ω–∞—Ä—É–∂–∏—Ç—å —Ç–æ–ø-10 —Å–∞–º—ã—Ö –±—ã—Å—Ç—Ä—ã—Ö —Ç–æ—á–µ–∫ –¥–æ—Å—Ç—É–ø–∞

``` r
wifi_ap_sorted_speed <- wifi_ap_sessions %>%
arrange(desc(speed)) %>%
slice_head(n = 10) %>%
select(bssid, essid, company, session_id, speed, first_seen, last_seen)

wifi_ap_sorted_speed
```

    # A tibble: 10 √ó 7
       bssid  essid company session_id speed first_seen          last_seen          
       <chr>  <chr> <chr>        <int> <dbl> <dttm>              <dttm>             
     1 26:20‚Ä¶ <NA>  <NA>             1   866 2023-07-28 09:15:45 2023-07-28 09:33:10
     2 8E:1F‚Ä¶ iPho‚Ä¶ <NA>             1   866 2023-07-28 10:08:32 2023-07-28 10:15:27
     3 96:FF‚Ä¶ <NA>  <NA>             1   866 2023-07-28 09:52:54 2023-07-28 10:25:02
     4 CE:48‚Ä¶ iPho‚Ä¶ <NA>             1   866 2023-07-28 09:59:20 2023-07-28 10:04:15
     5 02:B3‚Ä¶ HONO‚Ä¶ <NA>             1   360 2023-07-28 10:54:47 2023-07-28 10:54:47
     6 14:EB‚Ä¶ Gnez‚Ä¶ TP-Lin‚Ä¶          1   360 2023-07-28 09:25:01 2023-07-28 11:53:36
     7 4A:EC‚Ä¶ POCO‚Ä¶ <NA>             1   360 2023-07-28 09:13:03 2023-07-28 11:04:01
     8 56:C5‚Ä¶ OneP‚Ä¶ <NA>             1   360 2023-07-28 09:17:49 2023-07-28 10:27:22
     9 9A:75‚Ä¶ KC    <NA>             1   360 2023-07-28 09:13:03 2023-07-28 11:53:31
    10 E8:28‚Ä¶ MIRE‚Ä¶ Eltex ‚Ä¶          1   360 2023-07-28 09:18:16 2023-07-28 11:51:48

#### 6. –û—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ—á–∫–∏ –¥–æ—Å—Ç—É–ø–∞ –ø–æ —á–∞—Å—Ç–æ—Ç–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ (beacons) –≤ –µ–¥–∏–Ω–∏—Ü—É –≤—Ä–µ–º–µ–Ω–∏ –ø–æ –∏—Ö —É–±—ã–≤–∞–Ω–∏—é.

``` r
wifi_ap_sorted_beacon_rate <- wifi_ap_sessions %>%
filter(is.finite(beacon_rate)) %>%
arrange(desc(beacon_rate)) %>%
select(bssid, essid, company, session_id, beacons, duration, beacon_rate)

wifi_ap_sorted_beacon_rate
```

    # A tibble: 124 √ó 7
       bssid             essid       company session_id beacons duration beacon_rate
       <chr>             <chr>       <chr>        <int>   <dbl>    <dbl>       <dbl>
     1 F2:30:AB:E9:03:ED iPhone (Ul‚Ä¶ <NA>             1       6        7       0.857
     2 B2:CF:C0:00:4A:60 –ú–∏—Ö–∞–∏–ª's G‚Ä¶ <NA>             1       4        5       0.8  
     3 3A:DA:00:F9:0C:02 iPhone XS ‚Ä¶ <NA>             1       5        9       0.556
     4 00:3E:1A:5D:14:45 MT_FREE     <NA>             1       1        2       0.5  
     5 02:BC:15:7E:D5:DC MT_FREE     <NA>             1       1        2       0.5  
     6 76:C5:A0:70:08:96 <NA>        <NA>             1       1        2       0.5  
     7 D2:25:91:F6:6C:D8 –°–∞–Ω—è        <NA>             1       5       13       0.385
     8 BE:F1:71:D6:10:D7 C322U21 05‚Ä¶ <NA>             1    1647     9461       0.174
     9 00:03:7A:1A:03:56 MT_FREE     Taiyo ‚Ä¶          1       1        6       0.167
    10 38:1A:52:0D:84:D7 EBFCD57F-E‚Ä¶ Seiko ‚Ä¶          1     704     4319       0.163
    # ‚Ñπ 114 more rows

#### 1. –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–Ω–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞

–î–ª—è —ç—Ç–æ–≥–æ –≤–æ—Å–ø–æ–ª—å–∑—É–µ–º—Å—è —Ñ—É–Ω–∫—Ü–∏–µ–π `get_vendor()`, –Ω–∞–ø–∏—Å–∞–Ω–Ω–æ–π —Ä–∞–Ω–µ–µ. –î–ª—è
–∫–ª–∏–µ–Ω—Ç–æ–≤ –ª–æ–≥–∏—á–Ω–µ–µ –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—è –ø–æ `station_mac`:

``` r
wifi_clients_clean <- wifi_clients_clean %>%
  mutate(company = vapply(station_mac, get_vendor, character(1)))

wifi_clients_clean
```

    # A tibble: 12,081 √ó 8
       station_mac       first_seen          last_seen           power packets bssid
       <chr>             <dttm>              <dttm>              <dbl>   <dbl> <chr>
     1 CA:66:3B:8F:56:DD 2023-07-28 09:13:03 2023-07-28 10:59:44   -33     858 BE:F‚Ä¶
     2 96:35:2D:3D:85:E6 2023-07-28 09:13:03 2023-07-28 09:13:03   -65       4 <NA> 
     3 5C:3A:45:9E:1A:7B 2023-07-28 09:13:03 2023-07-28 11:51:54   -39     432 BE:F‚Ä¶
     4 C0:E4:34:D8:E7:E5 2023-07-28 09:13:03 2023-07-28 11:53:16   -61     958 BE:F‚Ä¶
     5 5E:8E:A6:5E:34:81 2023-07-28 09:13:04 2023-07-28 09:13:04   -53       1 <NA> 
     6 10:51:07:CB:33:E7 2023-07-28 09:13:05 2023-07-28 11:56:06   -43     344 <NA> 
     7 68:54:5A:40:35:9E 2023-07-28 09:13:06 2023-07-28 11:50:50   -31     163 1E:9‚Ä¶
     8 74:4C:A1:70:CE:F7 2023-07-28 09:13:06 2023-07-28 09:20:01   -71       3 E8:2‚Ä¶
     9 8A:A3:5A:33:76:57 2023-07-28 09:13:06 2023-07-28 10:20:27   -74     115 00:2‚Ä¶
    10 CA:54:C4:8B:B5:3A 2023-07-28 09:13:06 2023-07-28 11:55:04   -65     437 00:2‚Ä¶
    # ‚Ñπ 12,071 more rows
    # ‚Ñπ 2 more variables: probed_essids <chr>, company <chr>

#### 2. –û–±–Ω–∞—Ä—É–∂–∏—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞, –∫–æ—Ç–æ—Ä—ã–µ –ù–ï —Ä–∞–Ω–¥–æ–º–∏–∑–∏—Ä—É—é—Ç —Å–≤–æ–π MAC –∞–¥—Ä–µ—Å

–ù–µ—Ä–∞–Ω–¥–æ–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π MAC ‚Äî —ç—Ç–æ –≥–ª–æ–±–∞–ª—å–Ω–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–π –∞–¥—Ä–µ—Å (–±–∏—Ç LAA = 0).
–ü—Ä–æ–≤–µ—Ä—è–µ–º 2 –±–∏—Ç–∞ –ø–µ—Ä–≤–æ–≥–æ –æ–∫—Ç–µ—Ç–∞:

0x01 ‚Äî multicast (—Ç–∞–∫–∏–µ –ø—Ä–æ–ø—É—Å–∫–∞–µ–º),

0x02 ‚Äî locally administered (–µ—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω ‚Üí —Ä–∞–Ω–¥–æ–º–∏–∑–∞—Ü–∏—è; –µ—Å–ª–∏ –Ω–µ—Ç ‚Üí
–ù–ï —Ä–∞–Ω–¥–æ–º–∏–∑–∏—Ä—É–µ—Ç).

``` r
is_laa <- function(mac) {
  mac_hex <- toupper(gsub("[^0-9A-F]", "", mac))
  if (nchar(mac_hex) < 2) return(NA)
  
  b1 <- strtoi(substr(mac_hex, 1, 2), base = 16)
  if (is.na(b1)) return(NA)
  
  if (bitwAnd(b1, 0x01) != 0) return(NA)
  
  laa <- bitwAnd(b1, 0x02) != 0
  return(laa)
}

clients_nr <- wifi_clients_clean %>%
  mutate(is_randomized = vapply(station_mac, is_laa, logical(1))) %>%
  filter(is_randomized == FALSE) %>%
  select(station_mac, bssid, first_seen, last_seen, power, packets)

clients_nr
```

    # A tibble: 217 √ó 6
       station_mac       bssid first_seen          last_seen           power packets
       <chr>             <chr> <dttm>              <dttm>              <dbl>   <dbl>
     1 5C:3A:45:9E:1A:7B BE:F‚Ä¶ 2023-07-28 09:13:03 2023-07-28 11:51:54   -39     432
     2 C0:E4:34:D8:E7:E5 BE:F‚Ä¶ 2023-07-28 09:13:03 2023-07-28 11:53:16   -61     958
     3 10:51:07:CB:33:E7 <NA>  2023-07-28 09:13:05 2023-07-28 11:56:06   -43     344
     4 68:54:5A:40:35:9E 1E:9‚Ä¶ 2023-07-28 09:13:06 2023-07-28 11:50:50   -31     163
     5 74:4C:A1:70:CE:F7 E8:2‚Ä¶ 2023-07-28 09:13:06 2023-07-28 09:20:01   -71       3
     6 BC:F1:71:D4:DB:04 <NA>  2023-07-28 09:13:07 2023-07-28 10:57:52   -45     265
     7 4C:44:5B:14:76:E3 E8:2‚Ä¶ 2023-07-28 09:13:09 2023-07-28 09:47:44    -1      71
     8 A0:E7:0B:AE:D5:44 0A:C‚Ä¶ 2023-07-28 09:13:09 2023-07-28 11:34:42   -37     125
     9 00:95:69:E7:7F:35 <NA>  2023-07-28 09:13:11 2023-07-28 11:56:07   -69    2245
    10 00:95:69:E7:7C:ED <NA>  2023-07-28 09:13:11 2023-07-28 11:56:13   -55    4096
    # ‚Ñπ 207 more rows

#### –ö–ª–∞—Å—Ç–µ—Ä–∏–∑–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã –æ—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –∫ —Ç–æ—á–∫–∞–º –¥–æ—Å—Ç—É–ø–∞ –ø–æ –∏—Ö –∏–º–µ–Ω–∞–º. –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –≤—Ä–µ–º—è –ø–æ—è–≤–ª–µ–Ω–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –≤ –∑–æ–Ω–µ —Ä–∞–¥–∏–æ–≤–∏–¥–∏–º–æ—Å—Ç–∏ –∏ –≤—Ä–µ–º—è –≤—ã—Ö–æ–¥–∞ –µ–≥–æ –∏–∑ –Ω–µ–µ

–ú—ã –±—É–¥–µ–º –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –æ —Ç–æ—á–∫–∞—Ö –¥–æ—Å—Ç—É–ø–∞ –∏ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö,
—á—Ç–æ–±—ã –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∏—Ö –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –∏ –≤—Ä–µ–º—è –ø—Ä–µ–±—ã–≤–∞–Ω–∏—è –≤ –∑–æ–Ω–µ
—Ä–∞–¥–∏–æ–≤–∏–¥–∏–º–æ—Å—Ç–∏.–°–Ω–∞—á–∞–ª–∞ –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ–º –∏–º–µ–Ω–∞ —Å–µ—Ç–µ–π –∏ –æ—á–∏—Å—Ç–∏–º –¥–∞–Ω–Ω—ã–µ
–∫–ª–∏–µ–Ω—Ç–æ–≤, –∑–∞—Ç–µ–º —Å—Ñ–æ—Ä–º–∏—Ä—É–µ–º –¥–≤–µ –≤—ã–±–æ—Ä–∫–∏: —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞, –ø–æ–¥–∫–ª—é—á—ë–Ω–Ω—ã–µ –∫
—Ç–æ—á–∫–∞–º –¥–æ—Å—Ç—É–ø–∞ (assoc), –∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞, –æ—Ç–ø—Ä–∞–≤–ª—è–≤—à–∏–µ –∑–∞–ø—Ä–æ—Å—ã –Ω–∞
–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ (probe). –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –æ–±—ä–µ–¥–∏–Ω–∏–º –æ–±–µ –≤—ã–±–æ—Ä–∫–∏ –∏ —Å–≥—Ä—É–ø–ø–∏—Ä—É–µ–º –∏—Ö
–ø–æ –ø–∞—Ä–µ ¬´—É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ ‚Äî —Å–µ—Ç—å¬ª, –≤—ã—á–∏—Å–ª–∏–º –≤—Ä–µ–º—è –ø–µ—Ä–≤–æ–≥–æ –∏ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ
–ø–æ—è–≤–ª–µ–Ω–∏—è, –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–µ–±—ã–≤–∞–Ω–∏—è –∏ —Ç–∏–ø —Å–≤—è–∑–∏. –í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –ø–æ–ª—É—á–∏–º
—Ç–∞–±–ª–∏—Ü—É device_essid_presence, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∫–∞–∂–µ—Ç, –∫–∞–∫–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –∏ –∫–∞–∫
–¥–æ–ª–≥–æ –Ω–∞—Ö–æ–¥–∏–ª–∏—Å—å –≤ –∑–æ–Ω–µ –¥–µ–π—Å—Ç–≤–∏—è –∫–∞–∂–¥–æ–π —Å–µ—Ç–∏.

``` r
ap <- wifi_ap_clean %>%
  mutate(essid_norm = str_squish(essid))

ap_unique <- ap %>%
  filter(!is.na(essid_norm), nzchar(essid_norm)) %>%
  arrange(essid_norm, bssid) %>%
  distinct(essid_norm, .keep_all = TRUE)


cl <- wifi_clients_clean %>%
  mutate(
    probed_essids = if_else(is.na(probed_essids), "", probed_essids)
  )
assoc <- cl %>%
  filter(!is.na(bssid)) %>%
  left_join(
    ap %>% select(bssid, essid_norm),
    by = "bssid"
  ) %>%
  mutate(link_type = "associated")

probe <- cl %>%
  filter(is.na(bssid), nzchar(probed_essids)) %>%
  separate_rows(
    probed_essids,
    sep = ",\\s*",
    convert = FALSE
  ) %>%
  mutate(essid_norm = str_squish(probed_essids)) %>%
  filter(nzchar(essid_norm)) %>%
  inner_join(
    ap_unique %>% select(essid_norm, bssid),
    by = "essid_norm"
  ) %>%
  mutate(link_type = "probe")

device_essid_presence <- bind_rows(assoc, probe) %>%
  filter(!is.na(essid_norm), nzchar(essid_norm)) %>%
  group_by(station_mac, essid_norm) %>%
  summarise(
    first_seen_in = min(first_seen, na.rm = TRUE),
    last_seen_out = max(last_seen,  na.rm = TRUE),
    duration_sec  = as.numeric(difftime(last_seen_out, first_seen_in, units = "secs")),
    n_records     = dplyr::n(),
    link_types    = paste(sort(unique(link_type)), collapse = "+"),
    .groups       = "drop"
  ) %>%
  arrange(desc(duration_sec), station_mac, essid_norm)

device_essid_presence
```

    # A tibble: 466 √ó 7
       station_mac   essid_norm first_seen_in       last_seen_out       duration_sec
       <chr>         <chr>      <dttm>              <dttm>                     <dbl>
     1 8C:55:4A:DE:‚Ä¶ Galaxy A3‚Ä¶ 2023-07-28 09:13:17 2023-07-28 11:56:16         9779
     2 CA:54:C4:8B:‚Ä¶ GIVC       2023-07-28 09:13:06 2023-07-28 11:55:04         9718
     3 F6:4D:98:98:‚Ä¶ GIVC       2023-07-28 09:14:37 2023-07-28 11:55:29         9652
     4 C0:E4:34:D8:‚Ä¶ C322U13 3‚Ä¶ 2023-07-28 09:13:03 2023-07-28 11:53:16         9613
     5 5C:3A:45:9E:‚Ä¶ C322U21 0‚Ä¶ 2023-07-28 09:13:03 2023-07-28 11:51:54         9531
     6 28:7F:CF:23:‚Ä¶ KC         2023-07-28 09:13:14 2023-07-28 11:51:50         9516
     7 34:E1:2D:3C:‚Ä¶ Cnet       2023-07-28 09:13:29 2023-07-28 11:51:50         9501
     8 88:D8:2E:4F:‚Ä¶ POCO X5 P‚Ä¶ 2023-07-28 09:13:19 2023-07-28 11:51:24         9485
     9 FE:B7:DD:ED:‚Ä¶ MIREA_HOT‚Ä¶ 2023-07-28 09:13:55 2023-07-28 11:51:47         9472
    10 68:54:5A:40:‚Ä¶ Galaxy A71 2023-07-28 09:13:06 2023-07-28 11:50:50         9464
    # ‚Ñπ 456 more rows
    # ‚Ñπ 2 more variables: n_records <int>, link_types <chr>

``` r
client_clusters <- bind_rows(assoc, probe) %>%
  filter(!is.na(essid_norm), nzchar(essid_norm)) %>%
  group_by(station_mac, essid_norm)

stability <- client_clusters %>%
  summarise(
    n_obs    = n(),
    span_m   = as.numeric(
      max(last_seen, na.rm = TRUE) - min(first_seen, na.rm = TRUE),
      units = "mins"
    ),
    mean_rssi = mean(power, na.rm = TRUE),
    sd_rssi   = sd(power,   na.rm = TRUE),
    .groups   = "drop"
  ) %>%
  filter(n_obs > 5) %>%
  arrange(sd_rssi)

most_stable <- dplyr::slice_head(stability, n = 1)

stability
```

    # A tibble: 0 √ó 6
    # ‚Ñπ 6 variables: station_mac <chr>, essid_norm <chr>, n_obs <int>,
    #   span_m <dbl>, mean_rssi <dbl>, sd_rssi <dbl>

``` r
most_stable
```

    # A tibble: 0 √ó 6
    # ‚Ñπ 6 variables: station_mac <chr>, essid_norm <chr>, n_obs <int>,
    #   span_m <dbl>, mean_rssi <dbl>, sd_rssi <dbl>

#### –û—Ü–µ–Ω–∏—Ç—å —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å —É—Ä–æ–≤–Ω—è —Å–∏–≥–Ω–∞–ª–∞ –≤–Ω—É—Ä–∏ –∫–ª–∞—Å—Ç–µ—Ä–∞ –≤–æ –≤—Ä–µ–º–µ–Ω–∏. –í—ã—è–≤–∏—Ç—å –Ω–∞–∏–±–æ–ª–µ–µ —Å—Ç–∞–±–∏–ª—å–Ω—ã–π –∫–ª–∞—Å—Ç–µ—Ä.

–î–ª—è –æ—Ü–µ–Ω–∫–∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ —É—Ä–æ–≤–Ω—è —Å–∏–≥–Ω–∞–ª–∞ –∫–ª–∞—Å—Ç–µ—Ä –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∫–∞–∫ –ø–∞—Ä–∞
(—É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ, —Å–µ—Ç—å). –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è —Å–∏–≥–Ω–∞–ª–∞
–∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Ç–æ—á–∫–∏ –¥–æ—Å—Ç—É–ø–∞. –î–ª—è –∫–∞–∂–¥–æ–≥–æ
–∫–ª–∞—Å—Ç–µ—Ä–∞ –≤—ã—á–∏—Å–ª—è–ª–∏—Å—å –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–∂–∏–¥–∞–Ω–∏–µ —É—Ä–æ–≤–Ω—è —Å–∏–≥–Ω–∞–ª–∞ –∏ –µ–≥–æ
—Å—Ä–µ–¥–Ω–µ–∫–≤–∞–¥—Ä–∞—Ç–∏—á–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ.

``` r
client_clusters <- bind_rows(assoc, probe) %>%
  filter(!is.na(essid_norm), nzchar(essid_norm)) %>%
  group_by(station_mac, essid_norm)

stability <- client_clusters %>%
  summarise(
    n_obs    = n(),
    span_m   = as.numeric(
      max(last_seen, na.rm = TRUE) - min(first_seen, na.rm = TRUE),
      units = "mins"
    ),
    mean_rssi = mean(power, na.rm = TRUE),
    sd_rssi   = sd(power,   na.rm = TRUE),
    .groups   = "drop"
  ) %>%
  filter(n_obs > 5) %>% 
  arrange(sd_rssi)

most_stable <- dplyr::slice_head(stability, n = 1)

stability
```

    # A tibble: 0 √ó 6
    # ‚Ñπ 6 variables: station_mac <chr>, essid_norm <chr>, n_obs <int>,
    #   span_m <dbl>, mean_rssi <dbl>, sd_rssi <dbl>

``` r
most_stable
```

    # A tibble: 0 √ó 6
    # ‚Ñπ 6 variables: station_mac <chr>, essid_norm <chr>, n_obs <int>,
    #   span_m <dbl>, mean_rssi <dbl>, sd_rssi <dbl>

### –®–∞–≥ 3.

–û—Ñ–æ—Ä–º–∏—Ç—å –æ—Ç—á–µ—Ç

## –í—ã–≤–æ–¥

–í —Ö–æ–¥–µ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–π —Ä–∞–±–æ—Ç—ã —è —Ä–∞–∑–≤–∏–ª –Ω–∞–≤—ã–∫–∏ —Ä–∞–±–æ—Ç—ã —Å —è–∑—ã–∫–æ–º
–ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è R, –∞ —Ç–∞–∫–∂–µ –Ω–∞—É—á–∏–ª—Å—è –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–æ—Å—Ç–æ—è–Ω–∏–∏
–±–µ—Å–ø—Ä–æ–≤–æ–¥–Ω—ã—Ö —Å–µ—Ç–µ–π
